define(["base/js/namespace","base/js/utils","base/js/dialog","notebook/js/celltoolbar","base/js/events"],function(e,t,a,r,n){return function(e){function t(r){if(a[r])return a[r].exports;var n=a[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){function r(){console.log("Linker extension (notebook) loaded"),i.load(),n.load(),d.load(),l.load(),s.load(),p.load(),o.load(),c.load(),u.load()}a(9),a(10);var n=a(11),o=a(14),i=a(13),d=a(17),l=a(18),s=a(20),p=a(19),c=a(21),u=a(22);e.exports={load_ipython_extension:r}},,function(e,t,a){(function(t,r){/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
	 * @version   4.0.5
	 */
!function(t,a){e.exports=a()}(this,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function n(e){return"function"==typeof e}function o(e){V=e}function i(e){W=e}function d(){return function(){return t.nextTick(u)}}function l(){return"undefined"!=typeof z?function(){z(u)}:c()}function s(){var e=0,t=new Z(u),a=document.createTextNode("");return t.observe(a,{characterData:!0}),function(){a.data=e=++e%2}}function p(){var e=new MessageChannel;return e.port1.onmessage=u,function(){return e.port2.postMessage(0)}}function c(){var e=setTimeout;return function(){return e(u,1)}}function u(){for(var e=0;e<H;e+=2){var t=ae[e],a=ae[e+1];t(a),ae[e]=void 0,ae[e+1]=void 0}H=0}function f(){try{var e=a(4);return z=e.runOnLoop||e.runOnContext,l()}catch(e){return c()}}function h(e,t){var a=arguments,r=this,n=new this.constructor(v);void 0===n[ne]&&N(n);var o=r._state;return o?!function(){var e=a[o-1];W(function(){return T(o,n,e,r._result)})}():S(r,n,e,t),n}function b(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var a=new t(v);return k(a,e),a}function v(){}function m(){return new TypeError("You cannot resolve a promise with itself")}function $(){return new TypeError("A promises callback cannot return that same promise.")}function _(e){try{return e.then}catch(e){return le.error=e,le}}function y(e,t,a,r){try{e.call(t,a,r)}catch(e){return e}}function g(e,t,a){W(function(e){var r=!1,n=y(a,t,function(a){r||(r=!0,t!==a?k(e,a):L(e,a))},function(t){r||(r=!0,P(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&n&&(r=!0,P(e,n))},e)}function x(e,t){t._state===ie?L(e,t._result):t._state===de?P(e,t._result):S(t,void 0,function(t){return k(e,t)},function(t){return P(e,t)})}function C(e,t,a){t.constructor===e.constructor&&a===h&&t.constructor.resolve===b?x(e,t):a===le?P(e,le.error):void 0===a?L(e,t):n(a)?g(e,t,a):L(e,t)}function k(t,a){t===a?P(t,m()):e(a)?C(t,a,_(a)):L(t,a)}function w(e){e._onerror&&e._onerror(e._result),A(e)}function L(e,t){e._state===oe&&(e._result=t,e._state=ie,0!==e._subscribers.length&&W(A,e))}function P(e,t){e._state===oe&&(e._state=de,e._result=t,W(w,e))}function S(e,t,a,r){var n=e._subscribers,o=n.length;e._onerror=null,n[o]=t,n[o+ie]=a,n[o+de]=r,0===o&&e._state&&W(A,e)}function A(e){var t=e._subscribers,a=e._state;if(0!==t.length){for(var r=void 0,n=void 0,o=e._result,i=0;i<t.length;i+=3)r=t[i],n=t[i+a],r?T(a,r,n,o):n(o);e._subscribers.length=0}}function D(){this.error=null}function q(e,t){try{return e(t)}catch(e){return se.error=e,se}}function T(e,t,a,r){var o=n(a),i=void 0,d=void 0,l=void 0,s=void 0;if(o){if(i=q(a,r),i===se?(s=!0,d=i.error,i=null):l=!0,t===i)return void P(t,$())}else i=r,l=!0;t._state!==oe||(o&&l?k(t,i):s?P(t,d):e===ie?L(t,i):e===de&&P(t,i))}function O(e,t){try{t(function(t){k(e,t)},function(t){P(e,t)})}catch(t){P(e,t)}}function B(){return pe++}function N(e){e[ne]=pe++,e._state=void 0,e._result=void 0,e._subscribers=[]}function R(e,t){this._instanceConstructor=e,this.promise=new e(v),this.promise[ne]||N(this.promise),K(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?L(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&L(this.promise,this._result))):P(this.promise,E())}function E(){return new Error("Array Methods must be provided an Array")}function U(e){return new R(this,e).promise}function j(e){var t=this;return new t(K(e)?function(a,r){for(var n=e.length,o=0;o<n;o++)t.resolve(e[o]).then(a,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function Y(e){var t=this,a=new t(v);return P(a,e),a}function I(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function M(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function G(e){this[ne]=B(),this._result=this._state=void 0,this._subscribers=[],v!==e&&("function"!=typeof e&&I(),this instanceof G?O(this,e):M())}function F(){var e=void 0;if("undefined"!=typeof r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var a=null;try{a=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===a&&!t.cast)return}e.Promise=G}var J=void 0;J=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var K=J,H=0,z=void 0,V=void 0,W=function(e,t){ae[H]=e,ae[H+1]=t,H+=2,2===H&&(V?V(u):re())},X="undefined"!=typeof window?window:void 0,Q=X||{},Z=Q.MutationObserver||Q.WebKitMutationObserver,ee="undefined"==typeof self&&"undefined"!=typeof t&&"[object process]"==={}.toString.call(t),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ae=new Array(1e3),re=void 0;re=ee?d():Z?s():te?p():void 0===X?f():c();var ne=Math.random().toString(36).substring(16),oe=void 0,ie=1,de=2,le=new D,se=new D,pe=0;return R.prototype._enumerate=function(){for(var e=this.length,t=this._input,a=0;this._state===oe&&a<e;a++)this._eachEntry(t[a],a)},R.prototype._eachEntry=function(e,t){var a=this._instanceConstructor,r=a.resolve;if(r===b){var n=_(e);if(n===h&&e._state!==oe)this._settledAt(e._state,t,e._result);else if("function"!=typeof n)this._remaining--,this._result[t]=e;else if(a===G){var o=new a(v);C(o,e,n),this._willSettleAt(o,t)}else this._willSettleAt(new a(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},R.prototype._settledAt=function(e,t,a){var r=this.promise;r._state===oe&&(this._remaining--,e===de?P(r,a):this._result[t]=a),0===this._remaining&&L(r,this._result)},R.prototype._willSettleAt=function(e,t){var a=this;S(e,void 0,function(e){return a._settledAt(ie,t,e)},function(e){return a._settledAt(de,t,e)})},G.all=U,G.race=j,G.resolve=b,G.reject=Y,G._setScheduler=o,G._setAsap=i,G._asap=W,G.prototype={constructor:G,then:h,catch:function(e){return this.then(null,e)}},G.polyfill=F,G.Promise=G,G})}).call(t,a(3),function(){return this}())},function(e,t){function a(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function n(e){if(p===setTimeout)return setTimeout(e,0);if((p===a||!p)&&setTimeout)return p=setTimeout,setTimeout(e,0);try{return p(e,0)}catch(t){try{return p.call(null,e,0)}catch(t){return p.call(this,e,0)}}}function o(e){if(c===clearTimeout)return clearTimeout(e);if((c===r||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{return c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}function i(){b&&f&&(b=!1,f.length?h=f.concat(h):v=-1,h.length&&d())}function d(){if(!b){var e=n(i);b=!0;for(var t=h.length;t;){for(f=h,h=[];++v<t;)f&&f[v].run();v=-1,t=h.length}f=null,b=!1,o(e)}}function l(e,t){this.fun=e,this.array=t}function s(){}var p,c,u=e.exports={};!function(){try{p="function"==typeof setTimeout?setTimeout:a}catch(e){p=a}try{c="function"==typeof clearTimeout?clearTimeout:r}catch(e){c=r}}();var f,h=[],b=!1,v=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];h.push(new l(e,t)),1!==h.length||b||n(d)},l.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=s,u.addListener=s,u.once=s,u.off=s,u.removeListener=s,u.removeAllListeners=s,u.emit=s,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},function(e,t){},,,function(t,a){t.exports=e},function(e,a){e.exports=t},function(e,t,a){var r,n;r=[a(7),a(8)],n=function(t,a){"use strict";var r=function(){var e=a.url_path_join.apply(null,[t.notebook.base_url,"/dspace"]),r={type:"GET",processData:!1,cache:!1};return a.promising_ajax(e,r)},n=function(e){var r=a.url_path_join.apply(null,[t.notebook.base_url,"/sword"]),n={type:"POST",cache:!1,processData:!1,data:e,contentType:"application/json"};return a.promising_ajax(r,n)},o=function(e){var r=a.url_path_join.apply(null,[t.notebook.base_url,"/uploadbundle"]),n={type:"POST",processData:!1,data:e,contentType:"application/json"};return a.promising_ajax(r,n)},i=function(){var e=a.url_path_join.apply(null,[t.notebook.base_url,"/sword"]),r={processData:!1,cache:!1,type:"GET"};return a.promising_ajax(e,r)},d=function(e){var r=a.url_path_join.apply(null,[t.notebook.base_url,"/ldap"]),n={processData:!1,cache:!1,type:"POST",data:e,contentType:"application/json"};return a.promising_ajax(r,n)};e.exports={sword_get_servicedocument:i,get_collections:r,sword_new_item:n,upload_data:o,ldap_auth:d}}.apply(t,r),!(void 0!==n&&(e.exports=n))},function(e,t,a){var r,n;r=[],n=function(){"use strict";var t=function(e,t){var a=$("<div/>").addClass("alert alert-dismissible fade in").addClass(e).attr("role","alert").html(t).append($("<button/>").addClass("close").attr("type","button").attr("data-dismiss","alert").attr("aria-label","Close").append($("<span/>").attr("aria-hidden","true").html("&times;")));return $("#header").after(a),a};e.exports={create_alert:t}}.apply(t,r),!(void 0!==n&&(e.exports=n))},function(e,t,a){var r,n;r=[a(7),a(8),a(12),a(9),a(13)],n=function(t,a,r,n){var o=function(){var e=i(),a=$("<div/>").attr("title","Add the metadata").append($("<form/>").attr("id","add_metadata_form").append($("<label/>").attr("for","add_metadata_form").text("Add the metadata for the notebook.")).append(e.form1).append(e.form2)),n=r.modal({title:"Add "+t.notebook.notebook_name+" Metadata",body:a,buttons:{Cancel:{},Previous:{click:function(){!$("#fields1").hasClass("hide-me")&&$("#fields2").hasClass("hide-me")?$("#previous").addClass("disabled"):$("#fields1").hasClass("hide-me")&&!$("#fields2").hasClass("hide-me")&&($("#fields2").addClass("hide-me"),$("#fields1").removeClass("hide-me"),$("#next").text("Next"))}},Next:{class:"btn-primary",click:function(){!$("#fields1").hasClass("hide-me")&&$("#fields2").hasClass("hide-me")?(d(),0===$(".metadata-form-error").length&&($("#fields1").addClass("hide-me"),$("#fields2").removeClass("hide-me"),$("#previous").prop("disabled",!1),$("#next").text("Save"))):$("#fields1").hasClass("hide-me")&&!$("#fields2").hasClass("hide-me")&&(p(),0===$(".metadata-form-error").length&&(l().then(function(e){t.notebook.metadata.reportmetadata=e,t.notebook.save_notebook()}),$("#collections_loaded").remove(),$(".modal").modal("hide")))}}},notebook:t.notebook,keyboard_manager:t.notebook.keyboard_manager});n.on("shown.bs.modal",function(){$(".modal-footer > button.btn-sm").eq(1).removeAttr("data-dismiss").attr("id","previous").prop("disabled",!0),$(".modal-footer > button.btn-sm").eq(2).removeAttr("data-dismiss").attr("id","next"),$("#licence-file-radio").prop("disabled",!0),$("#licence-file").prop("disabled",!0),$("#licence-file-button").attr("disabled","disabled")})},i=function(){function e(){var e=$("<div/>"),t=s(S,"first"),a=s(S,"last");e.addClass("author additional-author").append(a).append(t);var r=$(".additional-author").last();L.detach();var n=$("<button/>").addClass("btn btn-xs btn-default btn-remove remove-author-button").attr("type","button").attr("aria-label","Remove author").click(function(){r.remove(),$(this).remove()});return n.append($("<i>").addClass("fa fa-trash").attr("aria-hidden","true")),r.append(n),P.append(e.append(L)),S++,[a,t,e]}function a(){var e=$("<div/>").addClass("nb-referencedBy_div"),t=$("<input/>").attr("class","nb-referencedBy referencedBy").attr("type","text").attr("id","nb-referencedBy-"+se),a=$(".nb-referencedBy_div").last();le.detach();var r=$("<button/>").addClass("btn btn-xs btn-default btn-remove remove-nb-referencedBy-button remove-referencedBy-button").attr("type","button").attr("aria-label","Remove referenced By URL").click(function(){a.remove(),$(this).remove()});return r.append($("<i>").addClass("fa fa-trash").attr("aria-hidden","true")),a.append(r),de.append(e.append(t).append(le)),se++,[t,e]}function r(){var e=$("<div/>").addClass("nb-citation_div"),t=$("<input/>").attr("class","nb-citation citation").attr("type","text").attr("id","nb-citation-"+pe),a=$(".nb-citation_div").last();re.detach();var r=$("<button/>").addClass("btn btn-xs btn-default btn-remove remove-nb-citation-button remove-citation-button").attr("type","button").attr("aria-label","Remove citation").click(function(){a.remove(),$(this).remove()});return r.append($("<i>").addClass("fa fa-trash").attr("aria-hidden","true")),a.append(r),ee.append(e.append(t).append(re)),pe++,[t,e]}var o=t.notebook.metadata,i=!1;o.hasOwnProperty("reportmetadata")&&(i=!0);var d=$("<input/>").attr("name","title").attr("id","title").attr("type","text").attr("required","required").val(""),l=$("<label/>").attr("for","title").addClass("required").text("Title: "),s=function(e,a){var r=$("<input/>").attr("class","author-"+a+"-name").attr("type","text").attr("id","author-"+a+"-name-"+e).autocomplete({source:function(r,n){var o=t.notebook.contents.base_url+"ldap",i={processData:!1,cache:!1,type:"GET",dataType:"json",success:function(e){n($.map(e,function(e){var t=JSON.parse(e);return t.attributes.displayName}))},error:function(e,t,a){var r=$("<div/>").addClass("ldap-error").text("Error: "+a+" when connecting to the LDAP server. You may want to check that your ldap server details in~/.jupyter/linker_extension_config.ini is correct. If the error persists please contact the developers.").css("color","red");$('label[for="author"]').after(r)}};"last"===a?$.ajax(o+"?"+$.param({lastname:r.term,firstname:$("#author-first-name-"+e).val()}),i):"first"===a&&$.ajax(o+"?"+$.param({lastname:$("#author-last-name-"+e).val(),firstname:r.term}),i)},focus:function(){return!1},search:function(){var e=$("#author-autocomplete-spinner").detach(),t=$("accessibility-spinner").detach();$(this).after(e),$(this).after(t),e.show(),t.show()},response:function(){$("#author-autocomplete-spinner").hide()},minLength:1});return 0===e?r.autocomplete({select:function(e,t){var r=t.item.value,n=r.split(" "),o=n[0].slice(0,-1),i=n[1],d=n[2].split(",")[2].slice(0,-1);"last"===a?($(this).val(o),$(this).parent().children().eq(1).val(i)):($(this).val(i),$(this).parent().children().eq(0).val(o));var l={SC:"SCD",RALSP:"RAL Space",DIA:"DLS",TECH:"Technology",CLF:"CLF",ISIS:"ISIS",PPD:"PPD",AST:"ASTeC",UKATC:"UKATC"},s=l[d];return $("#repository").val($("#repository option").filter(function(){return $(this).text()===s}).val()),!1}}):r.autocomplete({select:function(e,t){var r=t.item.value,n=r.split(" "),o=n[0].slice(0,-1),i=n[1];return"last"===a?($(this).val(o),$(this).parent().children().eq(1).val(i)):($(this).val(i),$(this).parent().children().eq(0).val(o)),!1}}),r},p=s(0,"last");p.attr("required","required");var c=s(0,"first");c.attr("required","required");var u=$("<i/>").addClass("fa fa-spinner fa-spin fa-fw fa-lg").attr("id","author-autocomplete-spinner").attr("aria-label","Searching for authors...").hide(),f=$("<span/>").addClass("sr-only").attr("id","accessibility-spinner").text("Searching for authors...").hide(),h=$("<label/>").attr("for","author").addClass("required").text("Author: "),b=$("<label/>").attr("for","author-first-name-0").addClass("required").text("First name(s), e.g. John: "),v=$("<label/>").attr("for","author-last-name-0").addClass("required").text("Last name, e.g. Smith: "),m=$("<div/>").addClass("author").append(p).append(c),_=$("<div/>").attr("id","author").append(v).append(b).append(m),y=$("<label/>").attr("for","additional-authors").text("Additional Authors: "),g=$("<label/>").attr("for","author-first-name-1").text("First name(s), e.g. John: "),x=$("<label/>").attr("for","author-last-name-1").text("Last name, e.g. Smith: "),C=s(1,"last"),k=s(1,"first"),w=$("<div/>").addClass("author additional-author").append(C).append(k),L=$("<button/>").addClass("btn btn-xs btn-default btn-add").attr("id","add-author-button").attr("type","button").attr("aria-label","Add author").bind("click",e);L.append($("<i>").addClass("fa fa-plus").attr("aria-hidden","true")),w.append(L);var P=$("<div/>").attr("id","additional-authors").append(x).append(g).append(w),S=2,A=$("<label/>").attr("for","nb-abstract").addClass("required").text("Abstract: "),D=$("<textarea/>").attr("name","abstract").attr("id","nb-abstract").attr("required","required"),q=$("<label/>").attr("for","tags").text("Tags: "),T=$("<textarea/>").attr("name","tags").attr("id","tags"),O=$("<label/>").attr("for","date").addClass("required").text("Date: "),B=$("<table/>").attr("id","date"),N=$("<label/>").attr("for","year").addClass("required").text("Year: ").attr("id","year-label"),R=$("<input/>").attr("name","year").attr("required","required").attr("id","year"),E=$("<label/>").attr("for","month").text("Month: ").attr("id","month-label"),U=$("<select/>").attr("name","month").attr("id","month").append($("<option/>").attr("value","0").text("")).append($("<option/>").attr("value","1").text("January")).append($("<option/>").attr("value","2").text("February")).append($("<option/>").attr("value","3").text("March")).append($("<option/>").attr("value","4").text("April")).append($("<option/>").attr("value","5").text("May")).append($("<option/>").attr("value","6").text("June")).append($("<option/>").attr("value","7").text("July")).append($("<option/>").attr("value","8").text("August")).append($("<option/>").attr("value","9").text("September")).append($("<option/>").attr("value","10").text("October")).append($("<option/>").attr("value","11").text("November")).append($("<option/>").attr("value","12").text("December")),j=$("<label/>").attr("for","day").text("Day: ").attr("id","day-label"),Y=$("<input/>").attr("name","day").attr("id","day"),I=$("<tr/>").attr("id","date-label-container"),M=$("<tr/>").attr("id","date-input-container");I.append($("<td>").append(N)).append($("<td>").append(E)).append($("<td>").append(j)),M.append($("<td>").append(R)).append($("<td>").append(U)).append($("<td>").append(Y)),B.append(I).append(M);var G=new Date;Y.val(G.getDate()),U.val(G.getMonth()+1),R.val(G.getFullYear());var F=$("<button/>").text("Clear date").attr("type","button").attr("id","clear-date").addClass("btn btn-xs btn-default btn-date").click(function(){Y.val(""),U.val("0"),R.val("")}),J=$("<button/>").text("Set to current date").attr("type","button").attr("id","current-date").addClass("btn btn-xs btn-default btn-date").click(function(){var e=new Date;Y.val(e.getDate()),U.val(e.getMonth()+1),R.val(e.getFullYear())});M.append(F),M.append(J);var K=$("<label/>").attr("for","language").text("Language: "),H=$("<select/>").attr("name","language").attr("id","language").append($("<option/>").attr("value","").text("n/A")).append($("<option/>").attr("value","en_US").text("English (US)")).append($("<option/>").attr("value","en").text("English (GB) (Default)")).append($("<option/>").attr("value","es").text("Spanish")).append($("<option/>").attr("value","de").text("German")).append($("<option/>").attr("value","fr").text("French")).append($("<option/>").attr("value","it").text("Italian")).append($("<option/>").attr("value","ja").text("Japanese")).append($("<option/>").attr("value","zh").text("Chinese")).append($("<option/>").attr("value","tr").text("Turkish")).append($("<option/>").attr("value","other").text("Other"));H.val("en");var z=$("<button/>").addClass("btn btn-info btn-sm btn-collapse").attr("type","button").attr("data-toggle","collapse").attr("data-target","#extra_nb_metadata_1").attr("aria-expanded","false").attr("aria-controls","extra_nb_metadata_1").text("Additional Metadata (click to expand)"),V=$("<div/>").addClass("collapse").attr("id","extra_nb_metadata_1").append(y).append(P).append(q).append(T).append(O).append(B).append(K).append(H),W=$("<fieldset/>").attr("title","fields1").attr("id","fields1").append(l).append(d).append(h).append(_).append(A).append(D).append(z).append(V);_.append(u),_.append(f);var X=$("<label/>").attr("for","publisher").text("Publisher: "),Q=$("<input/>").attr("name","publisher").attr("id","publisher"),Z=$("<label/>").attr("for","nb-citations").text("Add citations for any third party resources that have been used in this notebook: "),ee=$("<div/>"),te=$("<div/>").addClass("nb-citation_div"),ae=$("<input/>").addClass("nb-citation citation").attr("name","citation").attr("id","nb-citation-0"),re=$("<button/>").addClass("btn btn-xs btn-default btn-add add-citation-button").attr("id","add-nb-citation-button").attr("type","button").bind("click",r).attr("aria-label","Add citation");re.append($("<i>").addClass("fa fa-plus")),te.append(ae),te.append(re),ee.append(te);var ne=$("<label/>").attr("for","nb-referencedBy_div").text("Add URIs for items that reference this notebook or its data: "),oe=$("<input/>").addClass("nb-referencedBy referencedBy").attr("name","referencedBy").attr("id","nb-referencedBy-0"),ie=$("<div/>").addClass("nb-referencedBy_div"),de=$("<div/>"),le=$("<button/>").addClass("btn btn-xs btn-default btn-add add-ReferencedBy-button").attr("id","add-nb-referencedBy-button").attr("type","button").bind("click",a).attr("aria-label","Add referenced by URL");le.append($("<i>").addClass("fa fa-plus")),ie.append(oe),ie.append(le),de.append(ie);var se=1,pe=1,ce=$("<label/>").attr("for","funders").text("Funders: "),ue=$("<input/>").attr("name","funders").attr("id","funders"),fe=($("<label/>").attr("for","sponsors").text("Sponsors: "),$("<textarea/>").attr("name","sponsors").attr("id","sponsors")),he=$("<label/>").attr("for","licence").addClass("required").text("Licence: "),be=$("<div/>").attr("name","licence").attr("id","licence"),ve=$("<select/>").attr("name","licence dropdown").attr("required","required").attr("id","nb-licence-dropdown").append($("<option/>").attr("value","").text("None Selected")).append($("<option/>").attr("value","CC0").text("CC0")).append($("<option/>").attr("value","CC BY").text("CC BY")).append($("<option/>").attr("value","CC BY-SA").text("CC BY-SA")).append($("<option/>").attr("value","CC BY-NC").text("CC BY-NC")).append($("<option/>").attr("value","CC BY-ND").text("CC BY-ND")).append($("<option/>").attr("value","CC BY-NC-SA").text("CC BY-NC-SA")).append($("<option/>").attr("value","CC BY-NC-ND").text("CC BY-NC-ND")).append($("<option/>").attr("value","Apache 2.0").text("Apache-2.0")).append($("<option/>").attr("value","BSD-3-Clause").text("BSD-3-Clause")).append($("<option/>").attr("value","BSD-2-Clause").text("BSD-2-Clause")).append($("<option/>").attr("value","GPL-2.0").text("GPL-2.0")).append($("<option/>").attr("value","GPL-3.0").text("GPL-3.0")).append($("<option/>").attr("value","LGPL-2.1").text("LGPL-2.1")).append($("<option/>").attr("value","LGPL-3.0").text("LGPL-3.0")).append($("<option/>").attr("value","MIT").text("MIT")).append($("<option/>").attr("value","MPL-2.0").text("MPL-2.0")).append($("<option/>").attr("value","CDDL-1.0").text("CDDL-1.0")).append($("<option/>").attr("value","EPL-1.0").text("EPL-1.0")).append($("<option/>").attr("value","Other").text("Other")),me=$("<label/>").attr("for","nb-licence-dropdown").text('Please select a licence from one of the ones listed below, or select "Other" and specify your own licence'),$e=$("<input/>").attr("name","licence radio").attr("type","radio").attr("id","licence-file-radio").css("display","none").val("file"),_e=$("<label/>").attr("for","licence-file-radio").text("File Upload").css("display","none"),ye=$("<div/>").css("display","none"),ge=$("<span/>").attr("id","licence-file-button").addClass("btn btn-sm btn-default btn-file").text("Browse"),xe=$("<input/>").attr("readonly","readonly").attr("type","text").prop("disabled",!0),Ce=$("<input/>").attr("name","licence file").attr("id","licence-file").attr("type","file");ge.append(Ce),ye.append(ge).append(xe),Ce.change(function(){var e=$(this),t=e.get(0).files?e.get(0).files.length:1,a=e.val().replace(/\\/g,"/").replace(/.*\//,"");e.trigger("fileselect",[t,a])}),Ce.on("fileselect",function(e,t,a){var r=t>1?t+" files selected":a;xe.val(r)});var ke=$("<label/>").attr("for","licence-file").text('Upload a licence file. Note: you can only upload a file when ready to publish. If you are adding metadata in advance, please just select a licence type and change back to "Other" and upload your file when publishing.').css("display","none");ke.click(function(e){e.preventDefault()});var we=$("<input/>").attr("name","licence radio").attr("type","radio").attr("id","licence-url-radio").css("display","none").val("URL"),Le=$("<label/>").attr("for","licence-url-radio").text("URL").css("display","none"),Pe=$("<input/>").attr("name","licence url").attr("id","licence-url").css("display","none").attr("type","text"),Se=$("<label/>").attr("for","licence-url").text("Provide a URL that links to your licence").css("display","none");ve.change(function(){"Other"===$(this).val()?($e.css("display","inline"),we.css("display","inline"),ke.css("display","block"),Se.css("display","block"),_e.css("display","inline"),Le.css("display","inline"),ye.css("display","block"),Pe.css("display","block")):($e.css("display","none"),we.css("display","none"),ke.css("display","none"),Se.css("display","none"),_e.css("display","none"),Le.css("display","none"),ye.css("display","none"),Pe.css("display","none"))}),$e.change(function(){Pe.prop("disabled",!0),Ce.prop("disabled",!1),ge.removeAttr("disabled")}),we.change(function(){Pe.prop("disabled",!1),Ce.prop("disabled",!0),ge.attr("disabled","disabled")}),be.append(he).append(me).append(ve).append($("<br/>")).append($e).append(_e).append(ke).append(ye).append(we).append(Le).append(Se).append(Pe);var Ae=$("<label/>").attr("for","repository").addClass("required").text("Department: "),De=$("<select/>").attr("name","repository").attr("required","required").attr("id","repository").append($("<option/>").attr("value","").text("")),qe=n.get_collections();qe.then(function(e){var t=JSON.parse(e);t.forEach(function(e){var t=$("<option/>");t.attr("value",e.handle),t.text(e.name),De.append(t)}),$(document.body).append($("<div/>").attr("id","collections_loaded"))},function(e){console.log("Error fetching collections from eData: "),console.log(e.xhr);var t=$("<div/>").addClass("repository-fetch-error").text("Couldn't download the repository information from eData. Please reload and if the error persists contact the developers.").css("color","red");$('label[for="repository"]').after(t)});var Te=$("<button/>").addClass("btn btn-info btn-sm btn-collapse").attr("type","button").attr("data-toggle","collapse").attr("data-target","#extra_nb_metadata_2").attr("aria-expanded","false").attr("aria-controls","extra_nb_metadata_2").text("Additional Metadata (click to expand)"),Oe=$("<div/>").addClass("collapse").attr("id","extra_nb_metadata_2").append(X).append(Q).append(Z).append(ee).append(ne).append(de).append(ce).append(ue),Be=$("<fieldset/>").addClass("hide-me").attr("title","fields2").attr("id","fields2").append(he).append(be).append(Ae).append(De).append(Te).append(Oe);if(window.location.href.indexOf("user")!==-1){console.log("jupyterhub!");for(var Ne=window.location.href.split("/"),Re=0;Re<Ne.length&&"user"!==Ne[Re];Re++);var Ee=Ne[Re+1],Ue=t.notebook.contents.base_url+"ldap",je={processData:!1,cache:!1,type:"GET",dataType:"json",success:function(e){console.log(e);var t=JSON.parse(e);$("#author-first-name-0").val(t.attributes.givenName),$("#author-last-name-0").val(t.attributes.sn);var a=t.attributes.department,r={SC:"SCD",RALSP:"RAL Space",DIA:"DLS",TECH:"Technology",CLF:"CLF",ISIS:"ISIS",PPD:"PPD",AST:"ASTeC",UKATC:"UKATC"},n=r[a];qe.then(function(){$("#repository").val(n)})}};$.ajax(Ue+"?"+$.param({fedID:Ee}),je)}if(i){d.val(o.reportmetadata.title);var Ye,Ie=o.reportmetadata.authors;Ie.forEach(function(t,a){if(0===a)p.val(t[0]),c.val(t[1]);else if(1===a)C.val(t[0]),k.val(t[1]),Ie.length>2&&(Ye=$("<button/>").addClass("btn btn-xs btn-default btn-remove remove-author-button").attr("type","button").attr("aria-label","Remove author").click(function(){w.remove(),$(this).remove()}),Ye.append($("<i>").addClass("fa fa-trash").attr("aria-hidden","true")),w.append(Ye));else{var r=e();r[0].val(t[0]),r[1].val(t[1]),a!==Ie.length-1&&(Ye=$("<button/>").addClass("btn btn-xs btn-default btn-remove remove-author-button").attr("type","button").attr("aria-label","Remove author").click(function(){r[2].remove(),$(this).remove()}),Ye.append($("<i>").addClass("fa fa-trash").attr("aria-hidden","true")),r[2].append(Ye))}}),D.val(o.reportmetadata.abstract),o.reportmetadata.tags.forEach(function(e){T.val(T.val()+e+"\n")});var Me=o.reportmetadata.date.split("-");R.val(Me[0]),Me.length>1&&("0"===Me[1].charAt(0)&&(Me[1]=Me[1].charAt(1)),U.val(Me[1]),Y.val(Me[2])),H.val(o.reportmetadata.language),Q.val(o.reportmetadata.publisher);var Ge,Fe=o.reportmetadata.citations;Fe.forEach(function(e,t){if(0===t)ae.val(e),Fe.length>1&&(Ge=$("<button/>").addClass("btn btn-xs btn-default btn-remove remove-citation-button remove-nb-citation-button").attr("type","button").attr("aria-label","Remove citation").click(function(){ae.remove(),$(this).remove()}),Ge.append($("<i>").addClass("fa fa-trash").attr("aria-hidden","true")),te.append(Ge));else{var a=r();a[0].val(e),t!==Fe.length-1&&(Ge=$("<button/>").addClass("btn btn-xs btn-default btn-remove remove-citation-button remove-nb-citation-button").attr("type","button").attr("aria-label","Remove citaiton").click(function(){a[1].remove(),$(this).remove()}),Ge.append($("<i>").addClass("fa fa-trash").attr("aria-hidden","true")),a[1].append(Ge))}});var Je,Ke=o.reportmetadata.referencedBy;Ke.forEach(function(e,t){if(0===t)oe.val(e),Ke.length>1&&(Je=$("<button/>").addClass("btn btn-xs btn-default btn-remove remove-referencedBy-button remove-nb-referencedBy-button").attr("type","button").attr("aria-label","Remove referenced By URL").click(function(){oe.remove(),$(this).remove()}),Je.append($("<i>").addClass("fa fa-trash").attr("aria-hidden","true")),ie.append(Je));else{var r=a();r[0].val(e),t!==Ke.length-1&&(Je=$("<button/>").addClass("btn btn-xs btn-default btn-remove remove-referencedBy-button remove-nb-referencedBy-button").attr("type","button").attr("aria-label","Remove referenced By URL").click(function(){r[1].remove(),$(this).remove()}),Je.append($("<i>").addClass("fa fa-trash").attr("aria-hidden","true")),r[1].append(Je))}}),ue.val(o.reportmetadata.funders),fe.val(o.reportmetadata.sponsors),qe.then(function(){De.val(o.reportmetadata.repository)}),ve.val(o.reportmetadata.licence_preset),"Other"===o.reportmetadata.licence_preset&&($e.css("display","inline"),we.css("display","inline"),ke.css("display","block"),Se.css("display","block"),_e.css("display","inline"),Le.css("display","inline"),ye.css("display","block"),Pe.css("display","block")),Pe.val(o.reportmetadata.licence_url),Pe.val()&&we.prop("checked",!0)}return{form1:W,form2:Be}},d=function(){if($(".metadata-form-error").remove(),""===$("#title").val()){var e=$("<div/>").attr("id","title-missing-error").addClass("metadata-form-error").text("Please enter a title");$('label[for="title"]').after(e)}if(""===$("#nb-abstract").val()){var t=$("<div/>").attr("id","nb-abstract-missing-error").addClass("metadata-form-error").text("Please enter an abstract");$('label[for="nb-abstract"]').after(t)}if(""===$("#author-first-name-0").val()||""===$("#author-last-name-0").val()){var a=$("<div/>").attr("id","author-missing-error").addClass("metadata-form-error").text("Please enter an author");$('label[for="author"]').after(a)}var r=function(e,t,a){var r=~~Number(e);return String(r)===e&&r>t&&r<a},n=function(e,t,a){if(!r(e,0,32))return!1;var n=Number(e),o=Number(a),i=[31,28,31,30,31,30,31,31,30,31,30,31];return(o%400===0||o%100!==0&&o%4===0)&&(i[1]=29),n>0&&n<=i[t-1]};if(""===$("#year").val()){var o=$("<div/>").attr("id","year-missing-error").addClass("metadata-form-error").text("Please enter at least the year of publication");
$('label[for="date"]').after(o)}else if(r($("#year").val(),1800,3e3)){if(""!==$("#day").val()&&"0"===$("#month").val()){var i=$("<div/>").attr("id","month-missing-error").addClass("metadata-form-error").text("Please select a month");$('label[for="date"]').after(i)}else if(""!==$("#day").val()&&!n($("#day").val(),$("#month").val(),$("#year").val())){var d=$("<div/>").attr("id","invalid-day-error").addClass("metadata-form-error").text("Please enter valid day");$('label[for="date"]').after(d)}}else{var l=$("<div/>").attr("id","invalid-year-error").addClass("metadata-form-error").text("Please enter a valid year");$('label[for="date"]').after(l)}$(".metadata-form-error").css("color","red")},l=function(){var e={};e.title=$("#title").val(),e.authors=[],$(".author").each(function(t,a){var r=[],n=$(a).children(".author-last-name").val(),o=$(a).children(".author-first-name").val();""===n&&""===o||(r.push(n),r.push(o),e.authors.push(r))}),e.abstract=$("#nb-abstract").val();for(var t=$("#tags").val().split("\n"),a=[],r=0;r<t.length;r++)t[r]&&a.push(t[r]);e.tags=a;var n="";n=$("#month").val()<10?"0"+$("#month").val():$("#month").val(),"00"===n?e.date=$("#year").val():""===$("#day").val()?e.date=$("#year").val()+"-"+n:e.date=$("#year").val()+"-"+n+"-"+$("#day").val(),e.language=$("#language").val(),e.publisher=$("#publisher").val(),e.citations=[],$(".nb-citation").each(function(t,a){""!==$(a).val()&&e.citations.push($(a).val())}),e.referencedBy=[],$(".nb-referencedBy").each(function(t,a){""!==$(a).val()&&e.referencedBy.push($(a).val())}),e.funders=$("#funders").val(),e.sponsors=$("#sponsors").val(),e.licence_preset=$("#nb-licence-dropdown").val(),e.licence_url=$("#licence-url").val(),e.repository=$("#repository").val();var o;if($("#licence-file").val()){var i=$("#licence-file").prop("files")[0];o=new Promise(function(t,a){var r=new FileReader;r.onload=function(a){e.licence_file_name=$("#licence-file").val(),e.licence_file_contents=a.target.result,t(e)},r.onerror=function(){a()},r.readAsDataURL(i)})}else o=Promise.resolve(e);return o},s=function(){var e={title:t.notebook.metadata.reportmetadata.title,authors:t.notebook.metadata.reportmetadata.authors,abstract:t.notebook.metadata.reportmetadata.abstract,tags:t.notebook.metadata.reportmetadata.tags,date:t.notebook.metadata.reportmetadata.date,language:t.notebook.metadata.reportmetadata.language,publisher:t.notebook.metadata.reportmetadata.publisher,citations:t.notebook.metadata.reportmetadata.citations,referencedBy:t.notebook.metadata.reportmetadata.referencedBy,funders:t.notebook.metadata.reportmetadata.funders,sponsors:t.notebook.metadata.reportmetadata.sponsors,repository:t.notebook.metadata.reportmetadata.repository,licence_preset:t.notebook.metadata.reportmetadata.licence_preset,licence_url:t.notebook.metadata.reportmetadata.licence_url};return e},p=function(){if($(".metadata-form-error").remove(),""===$("#repository").val()){var e=$("<div/>").attr("id","repository-missing-error").addClass("metadata-form-error").text("Please select a repository to deposit to");$('label[for="repository"]').after(e)}if(""===$("#nb-licence-dropdown").val()){var t=$("<div/>").attr("id","licence-dropdown-error").addClass("metadata-form-error").text('Please select a licence or select "Other" and specify your own.');$('label[for="licence"]').after(t)}else if("Other"!==$("#nb-licence-dropdown").val()||$("#licence-url-radio").prop("checked")||$("#licence-file-radio").prop("checked")){if("Other"===$("#nb-licence-dropdown").val()&&""===$("#licence-url").val()&&$("#licence-url-radio").prop("checked")){var a=$("<div/>").attr("id","no-licence-url-error").addClass("metadata-form-error").text("Please provide a link to a licence file.");$('label[for="licence-url"]').after(a)}else if("Other"===$("#nb-licence-dropdown").val()&&""===$("#licence-file").val()&&$("#licence-file-radio").prop("checked")){var r=$("<div/>").attr("id","no-licence-file-error").addClass("metadata-form-error").text("Please upload a licence file.");$('label[for="licence-file"]').after(r)}}else{var n=$("<div/>").attr("id","no-licence-error").addClass("metadata-form-error").text("Please either provide a link to a licence or upload a licence file.");$('label[for="licence"]').after(n)}$(".metadata-form-error").css("color","red")},c={help:"Add notebook metadata",help_index:"a",icon:"fa-bars",handler:o},u="linker_extension",f="add-notebook-metadata",h=function(){t.actions.register(c,f,u),$("#add_metadata").click(function(){o()})};e.exports={load:h,validate_fields1:d,validate_fields2:p,create_fields:i,get_values_from_fields:l,get_values_from_metadata:s}}.apply(t,r),!(void 0!==n&&(e.exports=n))},function(e,t){e.exports=a},function(e,t,a){var r,n;r=[a(7),a(8)],n=function(t,r){var n=function(){var e=a(2).Promise,n=$("<li/>").addClass("dropdown publish-dropdown").append($("<a/>").attr("href","#").addClass("dropdown-toggle").attr("data-toggle","dropdown").text("Publish"));n.click(function(){var e=t.notebook.get_selected_index();t.notebook.select(e,!1)});var o=$("<ul/>").attr("id","publish_menu").addClass("dropdown-menu");n.append(o),$("ul.navbar-nav").append(n),o.append($("<li/>").attr("id","add_metadata").append($("<a/>").attr("href","#").text("Add Metadata"))).append($("<li/>").attr("id","sword_new_item").append($("<a/>").attr("href","#").text("New SWORD item"))).append($("<li/>").addClass("divider")).append($("<li/>").attr("id","select_data").append($("<a/>").attr("href","#").text("Select associated data"))).append($("<li/>").attr("id","view_data").append($("<a/>").attr("href","#").text("View associated data"))).append($("<li/>").attr("id","upload_data").append($("<a/>").attr("href","#").text("Upload associated data"))).append($("<li/>").addClass("divider")).append($("<li/>").attr("id","toggle_cell_references_bar").append($("<a/>").attr("href","#").text("Show/Hide cell references toolbar"))).append($("<li/>").attr("id","generate_references").append($("<a/>").attr("href","#").text("Generate references"))).append($("<li/>").addClass("divider")).append($("<li/>").attr("id","publish_notebook").append($("<a/>").attr("href","#").text("Publish Notebook"))).append($("<li/>").attr("id","publish_bundle").append($("<a/>").attr("href","#").text("Publish associated data"))).append($("<li/>").attr("id","publish_notebook_and_bundle").append($("<a/>").attr("href","#").text("Publish Notebook and associated data")));var i=new e(function(e){function a(){t.notebook.metadata?e():setTimeout(a,1e3)}a()});i.then(function(){"Linker Extension"!==t.notebook.metadata.celltoolbar?$("#toggle_cell_references_bar > a").text("Show cell references toolbar"):$("#toggle_cell_references_bar > a").text("Hide cell references toolbar")}),$("#download_pdf").remove();var d=$("<li>").attr("id","#download_pdf").append($("<a/>").attr("href","#").text("PDF via LaTeX (.pdf)"));d.click(function(){var e=r.encode_uri_components(t.notebook.notebook_path),a=r.url_path_join(t.notebook.base_url,"nbconvert","pdf","custom_article",e)+"?download=true",n=window.open("",t._target);t.notebook.dirty&&t.notebook.writable?t.notebook.save_notebook().then(function(){n.location=a}):n.location=a}),$("#download_rst").after(d)};e.exports={load:n}}.apply(t,r),!(void 0!==n&&(e.exports=n))},function(e,t,a){var r,n;r=[a(7),a(15),a(12),a(16)],n=function(t,a,r,n){"use strict";var o=function(){var e=a.CellToolbar;e.prototype._rebuild=e.prototype.rebuild,e.prototype.rebuild=function(){n.trigger("toolbar_rebuild.CellToolbar",this.cell),this._rebuild()},e._global_hide=e.global_hide,e.global_hide=function(){e._global_hide();for(var t=0;t<e._instances.length;t++)n.trigger("global_hide.CellToolbar",e._instances[t].cell)};var r=[];e.register_callback("linker_extension.add_reference_url",d),r.push("linker_extension.add_reference_url"),e.register_preset("Linker Extension",r,t.notebook);var o={help:"Show/hide the cell references bar on all the cells ",help_index:"g",icon:"fa-eye",handler:i},l="linker_extension",s="toggle-cell-references-bar";t.actions.register(o,s,l),$("#toggle_cell_references_bar").click(function(){i()})},i=function(){var e=a.CellToolbar;"Linker Extension"!==t.notebook.metadata.celltoolbar?(e.global_show(),e.activate_preset("Linker Extension"),t.notebook.metadata.celltoolbar="Linker Extension",$("#toggle_cell_references_bar > a").text("Hide cell references toolbar")):(e.global_hide(),delete t.notebook.metadata.celltoolbar,$("#toggle_cell_references_bar > a").text("Show cell references toolbar"))},d=function(e,a){function r(){a.metadata.referenceURLs=[],$(".referenceURL_"+a.cell_id).each(function(e,t){$(t).val()&&a.metadata.referenceURLs.push($(t).val())})}function n(){var e=$("<div/>").addClass("referenceURL_div").addClass("referenceURL_div_"+a.cell_id),n=$("<input/>").attr("class","referenceURL referenceURL_"+a.cell_id).attr("type","text").attr("name","referenceURL");n.focus(function(){t.keyboard_manager.edit_mode()}),n.change(function(){r()});var o=$(".referenceURL_div_"+a.cell_id).last();c.detach();var i=$("<button/>").addClass("btn btn-xs btn-default remove-cell-url-button").attr("type","button").attr("aria-label","Remove reference URL").click(function(){o.remove(),$(this).remove(),r()});return i.append($("<i>").addClass("fa fa-trash").attr("aria-hidden","true")),o.append(i),d.append(e.append(n).append(c)),[n,e]}var o="Add the reference URLs that relate to this cell:\n",i=$(e).addClass("cell-urls-container"),d=$("<div/>").addClass("cell-urls");i.append(o),i.append(d);var l=a.metadata.hasOwnProperty("referenceURLs");l||(a.metadata.referenceURLs=[]);var s=$("<input/>").addClass("referenceURL referenceURL_"+a.cell_id).attr("name","referenceURL"),p=$("<div/>").addClass("referenceURL_div").addClass("referenceURL_div_"+a.cell_id);p.append(s),s.focus(function(){t.keyboard_manager.edit_mode()}),s.change(function(){r()});var c=$("<button/>").addClass("btn btn-xs btn-default add-cell-url-button").attr("type","button").bind("click",n).attr("aria-label","Add reference URL");if(c.append($("<i>").addClass("fa fa-plus")),p.append(c),d.append(p),l){var u,f=a.metadata.referenceURLs;f.forEach(function(e,t){if(0===t)s.val(e),f.length>1&&(u=$("<button/>").addClass("btn btn-xs btn-default remove-cell-url-button").attr("type","button").attr("aria-label","Remove reference URL").click(function(){s.remove(),$(this).remove(),r()}),u.append($("<i>").addClass("fa fa-trash").attr("aria-hidden","true")),p.append(u));else{var a=n();a[0].val(e),t!==f.length-1&&(u=$("<button/>").addClass("btn btn-xs btn-default remove-cell-url-button").attr("type","button").attr("aria-label","Remove reference URL").click(function(){a[1].remove(),$(this).remove(),r()}),u.append($("<i>").addClass("fa fa-trash").attr("aria-hidden","true")),a[1].append(u))}})}};e.exports={load:o}}.apply(t,r),!(void 0!==n&&(e.exports=n))},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t,a){var r,n;r=[a(7),a(8),a(13)],n=function(t,a){var r=function(){sessionStorage.setItem("bundle",t.notebook.notebook_path);var e=a.url_path_split(t.notebook.notebook_path)[0];window.open(a.url_path_join(t.notebook.contents.base_url,"tree",a.encode_uri_components(e)),"_self")},n={help:"Select associated data",help_index:"d",icon:"fa-check-square-o",handler:r},o="linker_extension",i="select-associated-data",d=function(){t.actions.register(n,i,o),$("#select_data").click(function(){r()})};e.exports={load:d,select_data:r}}.apply(t,r),!(void 0!==n&&(e.exports=n))},function(e,t,a){var r,n;r=[a(7),a(8),a(12),a(10),a(9),a(19),a(11),a(13)],n=function(t,r,n,o,i,d,l){var s=a(2).Promise,p=function(){var e=h(),a=e.dialog_body,r=$("<table/>").attr("id","login-fields-upload-data"),o=$("<tr/>"),d=$("<tr/>"),s=$("<label/>").attr("for","username").addClass("required").text("Username: "),p=$("<input/>").attr("id","username").attr("required","required"),b=$("<label/>").attr("for","password").addClass("required").text("Password: "),v=$("<input/>").attr("id","password").attr("required","required").attr("type","password");o.append($("<td/>").append(s)).append($("<td/>").append(b)),d.append($("<td/>").append(p)).append($("<td/>").append(v)),r.append(o).append(d),a.append(r);var m=n.modal({title:"Upload Associated Data",body:a,default_button:"Cancel",buttons:{Cancel:{},Upload:{class:"btn-primary",click:function(){if($(".login-error").remove(),f(),0===$(".data-form-error").length){var a=$("#username").val(),r=$("#password").val(),n=JSON.stringify({username:a,password:r}),o=i.ldap_auth(n),s=c();o.then(function(){s.then(function(n){n.username=a,n.password=r,n.file_names=e.file_names,n.file_paths=e.file_paths,n.file_types=e.file_types,n.notebookpath=t.notebook.notebook_path;var o=l.get_values_from_metadata();Object.keys(o).forEach(function(e){n.hasOwnProperty(e)||(n[e]=o[e])}),u(n),$(".modal").modal("hide")}).catch(function(){var e=$("<div/>").addClass("upload-error").css("color","red").text("File upload failed - please try again.");$('label[for="TOS"]').after(e)})}).catch(function(e){var t=$("<div/>").addClass("login-error").css("color","red");401===e.xhr.status?(t.text("Login details not recognised."),d.after(t)):400===e.xhr.status?(t.text("Login details not valid."),d.after(t)):404===e.xhr.status?(t.text("LDAP server is invalid. Please check the config file; ~/.jupyter/linker_extension_config.ini, to check that your server url is correct."),d.after(t)):(console.log(e),console.log(e.text),t.text("Login failed - please try again."),d.after(t))})}}}},notebook:t.notebook,keyboard_manager:t.keyboard_manager});m.on("shown.bs.modal",function(){$(".modal-footer > .btn-primary").removeAttr("data-dismiss")})},c=function(){var e=[];$(".data-citation").each(function(t,a){""!==$(a).val()&&e.push($(a).val())});var t=$("#data-abstract").val();t+="\nCopyright: \n",t+=$("#copyright").val();var a=$("#data-licence-dropdown").val(),r=$("#TOS").prop("files"),n=[],o=[];if(r)for(var i=0;i<r.length;i++){var d=new s(function(e,t){var a=new FileReader;a.onload=function(t){n.push(t.target.result),e(t.target.result)},a.onerror=function(){t()},a.readAsDataURL(r[i])});o.push(d)}var l=s.all(o);return l.then(function(){var r={abstract:t,citations:e,licence:a,TOS:n};return r})},u=function(e){var a=t.notebook.metadata;"databundle_url"in a?o.create_alert("alert-warning","You have already uploaded the associate data for this notebook to eData and it will not be reuploaded."):"reportmetadata"in a&&"databundle"in a?i.upload_data(JSON.stringify(e)).then(function(e){var r="",n=e.split("\n");n.forEach(function(e){if(e.indexOf("<atom:id>")!==-1){var t=e.lastIndexOf("<"),a=e.slice(0,t),n=a.indexOf(">"),o=a.slice(n+1);r=o}}),a.databundle_url=r,t.notebook.save_notebook(),o.create_alert("alert-success data-upload-success-alert",'Success! Item created in eData! It is located here: <a href ="'+r+'">'+r+"</a>").attr("item-id",r)},function(e){o.create_alert("alert-danger","Error! "+e.message+", please try again. If it continues to fail please contact the developers.")}):("reportmetadata"in a||o.create_alert("alert-danger","Error! No report metadata - please  fill in the report metadata first."),"databundle"in a||o.create_alert("alert-danger","Error! No data associated with this notebook. You must select data to upload before you an upload it."))},f=function(){if($(".data-form-error").remove(),""===$("#data-abstract").val()){var e=$("<div/>").attr("id","abstract-missing-error").addClass("data-form-error").text("Please enter and abstract");$('label[for="data-abstract"]').after(e)}if(""===$("#copyright").val()){var t=$("<div/>").attr("id","copyright-missing-error").addClass("data-form-error").text("Please enter copyright information");$('label[for="copyright"]').after(t)}if(0===$("#TOS").prop("files").length){var a=$("<div/>").attr("id","TOS-missing-error").addClass("data-form-error").text("Please select the TOS files for the selected files");$('label[for="TOS"]').after(a)}if(""===$("#data-licence-dropdown").val()){var r=$("<div/>").attr("id","licence-missing-error").addClass("data-form-error").text("Please select the licence for the selected files");$('label[for="data-licence-dropdown"]').after(r)}$(".data-form-error").css("color","red")},h=function(){function e(){var e=$("<div/>").addClass("data-citation_div"),t=$("<input/>").attr("class","data-citation citation").attr("type","text").attr("id","data-citation-"+k),a=$(".data-citation_div").last();C.detach();var r=$("<button/>").addClass("btn btn-xs btn-default btn-remove remove-citation-button remove-data-citation-button").attr("type","button").attr("aria-label","Remove citation").click(function(){a.remove(),$(this).remove()});return r.append($("<i>").addClass("fa fa-trash").attr("aria-hidden","true")),a.append(r),y.append(e.append(t).append(C)),k++,[t,e]}var a=$("<div/>").attr("id","view-and-select-data").append($("<p/>").addClass("bundle-message").text("These are the files currently associated with "+t.notebook.notebook_name+" :")).append($("<br/>")),r=d.view_data();a.append(r.view_data_div);var n=r.file_names,o=r.file_paths,i=r.file_types,l=$("<label/>").attr("for","data-abstract").addClass("required").text("Please write an abstract here (You may want to write  something to describe each file in the bundle): "),s=$("<textarea/>").attr("name","abstract").attr("required","required").attr("id","data-abstract"),p="";n.forEach(function(e,t){"file"===i[t]&&(p+=e,t<n.length-1&&(p+="\n\n"))}),s.val(p);var c=$("<label/>").attr("for","data-licence-dropdown").addClass("required").text("Licence: "),u=$("<select/>").attr("name","licence dropdown").attr("id","data-licence-dropdown").attr("required","required").append($("<option/>").attr("value","").text("None Selected")).append($("<option/>").attr("value","CC0").text("CC0")).append($("<option/>").attr("value","CC BY").text("CC BY")).append($("<option/>").attr("value","CC BY-SA").text("CC BY-SA")).append($("<option/>").attr("value","CC BY-NC").text("CC BY-NC")).append($("<option/>").attr("value","CC BY-ND").text("CC BY-ND")).append($("<option/>").attr("value","CC BY-NC-SA").text("CC BY-NC-SA")).append($("<option/>").attr("value","CC BY-NC-ND").text("CC BY-NC-ND")).append($("<option/>").attr("value","Apache 2.0").text("Apache-2.0")).append($("<option/>").attr("value","BSD-3-Clause").text("BSD-3-Clause")).append($("<option/>").attr("value","BSD-2-Clause").text("BSD-2-Clause")).append($("<option/>").attr("value","GPL-2.0").text("GPL-2.0")).append($("<option/>").attr("value","GPL-3.0").text("GPL-3.0")).append($("<option/>").attr("value","LGPL-2.1").text("LGPL-2.1")).append($("<option/>").attr("value","LGPL-3.0").text("LGPL-3.0")).append($("<option/>").attr("value","MIT").text("MIT")).append($("<option/>").attr("value","MPL-2.0").text("MPL-2.0")).append($("<option/>").attr("value","CDDL-1.0").text("CDDL-1.0")).append($("<option/>").attr("value","EPL-1.0").text("EPL-1.0")),f=$("<label/>").attr("for","TOS").addClass("required").text("Terms of Service: "),h=$("<div/>"),b=$("<span/>").addClass("btn btn-sm btn-default btn-file").text("Browse"),v=$("<input/>").attr("readonly","readonly").attr("type","text").prop("disabled",!0),m=$("<input>").attr("type","file").attr("id","TOS").attr("required","required").attr("name","TOS[]").attr("multiple","multiple");b.append(m),h.append(b).append(v),m.change(function(){var e=$(this),t=e.get(0).files?e.get(0).files.length:1,a=e.val().replace(/\\/g,"/").replace(/.*\//,"");e.trigger("fileselect",[t,a])}),m.on("fileselect",function(e,t,a){var r=t>1?t+" files selected":a;v.val(r)});var _=$("<label/>").attr("for","data-citations").text("Citations: "),y=$("<div/>").attr("id","data-citations"),g=$("<div/>").addClass("data-citation_div"),x=$("<input/>").addClass("data-citation citation").attr("name","citation").attr("id","data-citation-0"),C=$("<button/>").addClass("btn btn-xs btn-default btn-add add-citation-button").attr("id","add-data-citation-button").attr("type","button").bind("click",e).attr("aria-label","Add citation");C.append($("<i>").addClass("fa fa-plus")),g.append(x),g.append(C),y.append(g);var k=1,w=$("<label/>").attr("for","copyright").addClass("required").text("Copyright: "),L=$("<textarea/>").attr("id","copyright").attr("required","required").attr("name","copyright"),P=$("<fieldset/>").attr("title","data_fields").attr("id","data_fields").append(l).append(s).append(c).append(u).append(f).append(h).append(_).append(y).append(w).append(L),S=$("<div/>").append(a).append(P);return{dialog_body:S,file_names:n,file_paths:o,file_types:i}},b={help:"Upload associated data",help_index:"b",icon:"fa-upload",handler:p},v="linker_extension",m="upload-associated-data",_=function(){t.actions.register(b,m,v),$("#upload_data").click(function(){p()})};e.exports={load:_,upload_data_form:h,upload_data:u,validate_upload_data:f,get_values_from_fields:c}}.apply(t,r),!(void 0!==n&&(e.exports=n))},function(e,t,a){var r,n;r=[a(7),a(12),a(8),a(13),a(17)],n=function(t,a,r,n){var o=function(){var e=$("<div/>").append($("<p/>").addClass("bundle-message").text("These are the files currently associated with "+t.notebook.notebook_name+" :")).append($("<br/>")).append(i().view_data_div);a.modal({title:"View Associated Data",body:e,default_button:"OK",buttons:{OK:{}}})},i=function(){var e=$("<div/>").attr("id","view_data_container"),a=[],o=[],i=[],d=$("<button/>").addClass("btn btn-xs btn-default select-data-button").attr("type","button").text("Select data").attr("title","Select data to associate with this notebook").attr("aria-label","Select data to associate with this notebook").click(function(){n.select_data()}),l=$("<div/>").attr("id","associated-files");if($.isEmptyObject(t.notebook.metadata))e.append(l.text("You have associated no fileswith this notebook!"));else{if("databundle"in t.notebook.metadata){var s=t.notebook.metadata.databundle,p={directory:0,notebook:1,file:2},c=s.slice();c.sort(function(e,t){return p[e.type]<p[t.type]?-1:p[e.type]>p[t.type]?1:e.path.toLowerCase()<t.path.toLowerCase()?-1:e.path.toLowerCase()>t.path.toLowerCase()?1:0});var u={};c.forEach(function(e){var t=$("<div/>").text(e.path).attr("data-indent",0).attr("class","bundle-item").css("margin-left","0px");if("directory"===e.type&&(u[e.path]=t),u.hasOwnProperty(r.url_path_split(e.path)[0])){var n=r.url_path_split(e.path)[0],d=u[n].attr("data-indent")+1;t.text(e.name).attr("data-indent",d).css("margin-left","12px"),u[n].append(t)}else l.append(t);a.push(e.name),o.push(e.path),i.push(e.type)}),e.append(l)}else e.append(l.text("You have associated no files with this notebook!"));if("databundle_url"in t.notebook.metadata){var f=$("<div/>").attr("id","exists-warning");f.append($("<strong/>").text("ATTENTION: ").css("color","red")),f.append($("<p/>").text("You have already uploaded the associated data for this notebook. It is located here: ")),f.append($("<a/>").attr("href",t.notebook.metadata.databundle_url).text(t.notebook.metadata.databundle_url)),e.append(f)}}return e.append($("<br/>")),l.after(d),{view_data_div:e,file_names:a,file_paths:o,file_types:i}},d={help:"View associated data",help_index:"c",icon:"fa-eye",handler:i},l="linker_extension",s="view-associated-data",p=function(){t.actions.register(d,s,l),$("#view_data").click(function(){o()})};e.exports={load:p,view_data:i}}.apply(t,r),!(void 0!==n&&(e.exports=n))},function(e,t,a){var r,n;r=[a(7),a(8),a(12),a(10),a(9),a(11),a(13)],n=function(t,r,n,o,i,d){var l=(a(2).Promise,function(e){i.sword_new_item(JSON.stringify(e)).then(function(e){var t="",a=e.split("\n");a.forEach(function(e){if(e.indexOf("<atom:id>")!==-1){var a=e.lastIndexOf("<"),r=e.slice(0,a),n=r.indexOf(">"),o=r.slice(n+1);t=o}}),o.create_alert("alert-success nb-upload-success-alert",'Success! Item created in eData! It is located here: <a href ="'+t+'">'+t+"</a>").attr("item-id",t)},function(e){o.create_alert("alert-danger","Error! "+e.message+", please try again. If it continues to fail please contact the developers.")})}),s=function(){var e=$("<table/>").attr("id","login-fields-new-item"),a=$("<tr/>"),r=$("<tr/>"),s=$("<label/>").attr("for","username").addClass("required").text("Username: "),p=$("<input/>").attr("id","username").attr("required","required"),c=$("<label/>").attr("for","password").addClass("required").text("Password: "),u=$("<input/>").attr("id","password").attr("required","required").attr("type","password");a.append($("<td/>").append(s)).append($("<td/>").append(c)),r.append($("<td/>").append(p)).append($("<td/>").append(u)),e.append(a).append(r);var f=n.modal({title:"Upload Notebook",body:e,default_button:"Cancel",buttons:{Upload:{class:"btn-primary",click:function(){if("reportmetadata"in t.notebook.metadata){$(".login-error").remove();var e=$("#username").val(),a=$("#password").val(),n=JSON.stringify({username:e,password:a}),s=i.ldap_auth(n);s.then(function(){var r=d.get_values_from_metadata();r.username=e,r.password=a,r.notebookpath=t.notebook.notebook_path,l(r),$(".modal").modal("hide")}).catch(function(e){var t=$("<div/>").addClass("login-error").css("color","red");401===e.xhr.status?(t.text("Login details not recognised."),r.after(t)):400===e.xhr.status?(t.text("Login details not valid."),r.after(t)):404===e.xhr.status?(t.text("LDAP server is invalid. Please check the config file; ~/.jupyter/linker_extension_config.ini, to check that your server url is correct."),r.after(t)):(console.log(e),console.log(e.text),t.text("Login failed - please try again."),r.after(t))})}else o.create_alert("alert-danger",'Error! No metadata found. Please use the "Add Metadata" menu item to add the metadata for this report')}},Cancel:{}},notebook:t.notebook,keyboard_manager:t.keyboard_manager});f.on("shown.bs.modal",function(){$(".modal-footer > .btn-primary").removeAttr("data-dismiss")})},p={help:"Upload notebook",help_index:"e",icon:"fa-upload",handler:l},c="linker_extension",u="upload-notebook-data",f=function(){t.actions.register(p,u,c),$("#sword_new_item").click(function(){s()})};e.exports={load:f,upload_notebook:l}}.apply(t,r),!(void 0!==n&&(e.exports=n))},function(e,t,a){var r,n;r=[a(7),a(8),a(12),a(9),a(19),a(11),a(17),a(20),a(18),a(13)],n=function(t,r,n,o,i,d,l,s,p){var c=(a(2).Promise,function(){var e=d.create_fields();e.form1.addClass("hide-me"),e.form2.addClass("hide-me");var a=$("<label/>").attr("id","publish_instructions").attr("for","publish_form");a.text('Check the files currently associated with this notebook and add additional metadata for the zip file contianing all the following files. Click the "Select Data" button to navigate away from this page to select additional data to associate with this notebook');var r=p.upload_data_form(),i=$("<div/>").attr("id","upload-data-container").append(r.dialog_body),l=$("<div/>").attr("title","Publish notebook").append($('<form id="publish_form"/>').append(a).append(i).append(e.form1).append(e.form2)),c=$("<div/>").attr("id","final-page");c.addClass("hide-me");var u=$("<table/>").attr("id","login-fields-upload-data"),f=$("<tr/>"),h=$("<tr/>"),b=$("<label/>").attr("for","username").addClass("required").text("Username: "),v=$("<input/>").attr("id","username").attr("required","required"),m=$("<label/>").attr("for","password").addClass("required").text("Password: "),_=$("<input/>").attr("id","password").attr("required","required").attr("type","password");f.append($("<td/>").append(b)).append($("<td/>").append(m)),h.append($("<td/>").append(v)).append($("<td/>").append(_)),u.append(f).append(h),c.append(u),l.append(c);var y={},g={},x=n.modal({title:"Publish Notebook and Data",body:l,buttons:{Cancel:{},Previous:{click:function(){$("#upload-data-container").hasClass("hide-me")&&!$("#fields1").hasClass("hide-me")?($("#fields1").addClass("hide-me"),$("#upload-data-container").removeClass("hide-me"),$("#previous").prop("disabled",!0),a.text('Check the files currently associated with this notebook. Click the "Select Data" button to navigate away from this page to select additional data to associate with this notebook')):$("#fields1").hasClass("hide-me")&&!$("#fields2").hasClass("hide-me")?($("#fields2").addClass("hide-me"),$("#fields1").removeClass("hide-me")):$("#fields2").hasClass("hide-me")&&!$("#final-page").hasClass("hide-me")&&($("#final-page").addClass("hide-me"),$("#fields2").removeClass("hide-me"),$("#next").text("Next"),a.text("Check and edit the metadata for the notebook before uploading to eData."))}},Next:{class:"btn-primary",click:function(){if($("#upload-data-container").hasClass("hide-me"))if($("#fields1").hasClass("hide-me"))if($("#fields2").hasClass("hide-me")){if(!$("#final-page").hasClass("hide-me")){$(".login-error").remove();var e=$("#username").val(),n=$("#password").val(),i=JSON.stringify({username:e,password:n}),l=o.ldap_auth(i);l.then(function(){y.username=e,y.password=n,y.notebookpath=t.notebook.notebook_path,Object.keys(y).forEach(function(e){g.hasOwnProperty(e)||(g[e]=y[e])}),p.upload_data(g),s.upload_notebook(y),$(".modal").modal("hide")}).catch(function(e){var t=$("<div/>").addClass("login-error").css("color","red");401===e.xhr.status?(t.text("Login details not receognised."),a.after(t)):400===e.xhr.status?(t.text("Login details not valid."),a.after(t)):404===e.xhr.status?(t.text("LDAP server is invalid. Please check the config file; ~/.jupyter/linker_extension_config.ini, to check that your server url is correct."),h.after(t)):(console.log(e),console.log(e.text),t.text("Login failed - please try again."),h.after(t))})}}else d.validate_fields2(),0===$(".metadata-form-error").length&&d.get_values_from_fields().then(function(e){t.notebook.metadata.reportmetadata=e,t.notebook.save_notebook(),y=e,$("#fields2").addClass("hide-me"),$("#final-page").removeClass("hide-me"),$("#next").text("Publish"),a.text("Confirm that you would like to upload the notebook and data bundle.")}).catch(function(){var e=$("<div/>").addClass("upload-error").css("color","red").text("File upload failed - please try again.");a.after(e)});else d.validate_fields1(),0===$(".metadata-form-error").length&&($("#fields1").addClass("hide-me"),$("#fields2").removeClass("hide-me"));else if(p.validate_upload_data(),0===$(".data-form-error").length){var c=p.get_values_from_fields();c.then(function(e){g=e,g.file_names=r.file_names,g.file_paths=r.file_paths,g.file_types=r.file_types,$("#upload-data-container").addClass("hide-me"),$("#fields1").removeClass("hide-me"),$("#previous").prop("disabled",!1),a.text("Check and edit the metadata for the notebook before uploading to eData.")}).catch(function(){var e=$("<div/>").addClass("upload-error").css("color","red").text("File upload failed - please try again.");a.after(e)})}}}},notebook:t.notebook,keyboard_manager:t.notebook.keyboard_manager});x.on("shown.bs.modal",function(){$(".modal-footer > button.btn-sm").eq(1).removeAttr("data-dismiss").attr("id","previous").prop("disabled",!0),$(".modal-footer > button.btn-sm").eq(2).removeAttr("data-dismiss").attr("id","next")})}),u=function(){var e=d.create_fields();e.form2.addClass("hide-me");var a=$("<label/>").attr("id","publish_instructions").attr("for","publish_form");a.text('Check the files currently associated with this notebook and add additional metadata for the zip file contianing all the following files. Click the "Select Data" button to navigate away from this page to select additional data to associate with this notebook');var r=$("<div/>").attr("title","Publish notebook").append($('<form id="publish_form"/>').append(a).append(e.form1).append(e.form2)),i=$("<div/>").attr("id","final-page");i.addClass("hide-me");var l=$("<table/>").attr("id","login-fields-upload-data"),p=$("<tr/>"),c=$("<tr/>"),u=$("<label/>").attr("for","username").addClass("required").text("Username: "),f=$("<input/>").attr("id","username").attr("required","required"),h=$("<label/>").attr("for","password").addClass("required").text("Password: "),b=$("<input/>").attr("id","password").attr("required","required").attr("type","password");p.append($("<td/>").append(u)).append($("<td/>").append(h)),c.append($("<td/>").append(f)).append($("<td/>").append(b)),l.append(p).append(c),i.append(l),r.append(i);var v={},m=n.modal({title:"Publish Notebook",body:r,buttons:{
Cancel:{},Previous:{click:function(){$("#fields1").hasClass("hide-me")&&!$("#fields2").hasClass("hide-me")?($("#fields2").addClass("hide-me"),$("#fields1").removeClass("hide-me"),$("#previous").prop("disabled",!0)):$("#fields2").hasClass("hide-me")&&!$("#final-page").hasClass("hide-me")&&($("#final-page").addClass("hide-me"),$("#fields2").removeClass("hide-me"),$("#next").text("Next"),a.text("Check and edit the metadata for the notebook before uploading to eData."))}},Next:{class:"btn-primary",click:function(){if($("#fields1").hasClass("hide-me"))if($("#fields2").hasClass("hide-me")){if(!$("#final-page").hasClass("hide-me")){$(".login-error").remove();var e=$("#username").val(),r=$("#password").val(),n=JSON.stringify({username:e,password:r}),i=o.ldap_auth(n);i.then(function(){v.username=e,v.password=r,v.notebookpath=t.notebook.notebook_path,s.upload_notebook(v),$(".modal").modal("hide")}).catch(function(e){var t=$("<div/>").addClass("login-error").css("color","red");401===e.xhr.status?(t.text("Login details not receognised."),a.after(t)):400===e.xhr.status?(t.text("Login details not valid."),a.after(t)):404===e.xhr.status?(t.text("LDAP server is invalid. Please check the config file; ~/.jupyter/linker_extension_config.ini, to check that your server url is correct."),c.after(t)):(console.log(e),console.log(e.text),t.text("Login failed - please try again."),c.after(t))})}}else d.validate_fields2(),0===$(".metadata-form-error").length&&d.get_values_from_fields().then(function(e){t.notebook.metadata.reportmetadata=e,t.notebook.save_notebook(),v=e,$("#fields2").addClass("hide-me"),$("#final-page").removeClass("hide-me"),$("#next").text("Publish"),a.text("Confirm that you would like to upload the notebook.")}).catch(function(){var e=$("<div/>").addClass("upload-error").css("color","red").text("File upload failed - please try again.");a.after(e)});else d.validate_fields1(),0===$(".metadata-form-error").length&&($("#fields1").addClass("hide-me"),$("#fields2").removeClass("hide-me"),$("#previous").prop("disabled",!1))}}},notebook:t.notebook,keyboard_manager:t.notebook.keyboard_manager});m.on("shown.bs.modal",function(){$(".modal-footer > button.btn-sm").eq(1).removeAttr("data-dismiss").attr("id","previous").prop("disabled",!0),$(".modal-footer > button.btn-sm").eq(2).removeAttr("data-dismiss").attr("id","next")})},f=function(){var e=$("<label/>").attr("id","publish_instructions").attr("for","publish_form");e.text('Check the files currently associated with this notebook and add additional metadata for the zip file contianing all the following files. Click the "Select Data" button to navigate away from this page to select additional data to associate with this notebook');var a=p.upload_data_form(),r=$("<div/>").attr("id","upload-data-container").append(a.dialog_body),i=$("<div/>").attr("title","Publish data").append($('<form id="publish_form"/>').append(e).append(r)),l=$("<div/>").attr("id","final-page");l.addClass("hide-me");var s=$("<table/>").attr("id","login-fields-upload-data"),c=$("<tr/>"),u=$("<tr/>"),f=$("<label/>").attr("for","username").addClass("required").text("Username: "),h=$("<input/>").attr("id","username").attr("required","required"),b=$("<label/>").attr("for","password").addClass("required").text("Password: "),v=$("<input/>").attr("id","password").attr("required","required").attr("type","password");c.append($("<td/>").append(f)).append($("<td/>").append(b)),u.append($("<td/>").append(h)).append($("<td/>").append(v)),s.append(c).append(u),l.append(s),i.append(l);var m={},_=n.modal({title:"Publish Data",body:i,buttons:{Cancel:{},Previous:{click:function(){$("#upload-data-container").hasClass("hide-me")&&!$("#final-page").hasClass("hide-me")&&($("#final-page").addClass("hide-me"),$("#upload-data-container").removeClass("hide-me"),$("#previous").prop("disabled",!0),$("#next").text("Next"))}},Next:{class:"btn-primary",click:function(){if($("#upload-data-container").hasClass("hide-me")){if(!$("#final-page").hasClass("hide-me")){$(".login-error").remove();var r=$("#username").val(),n=$("#password").val(),i=JSON.stringify({username:r,password:n}),l=o.ldap_auth(i);l.then(function(){m.username=r,m.password=n;var e=d.get_values_from_metadata();Object.keys(e).forEach(function(t){m.hasOwnProperty(t)||(m[t]=e[t])}),p.upload_data(m),$(".modal").modal("hide")}).catch(function(t){var a=$("<div/>").addClass("login-error").css("color","red");401===t.xhr.status?(a.text("Login details not receognised."),e.after(a)):400===t.xhr.status?(a.text("Login details not valid."),e.after(a)):404===t.xhr.status?(a.text("LDAP server is invalid. Please check the config file; ~/.jupyter/linker_extension_config.ini, to check that your server url is correct."),u.after(a)):(console.log(t),console.log(t.text),a.text("Login failed - please try again."),u.after(a))})}}else if(p.validate_upload_data(),0===$(".data-form-error").length){var s=p.get_values_from_fields();s.then(function(r){m=r,m.file_names=a.file_names,m.file_paths=a.file_paths,m.file_types=a.file_types,m.notebookpath=t.notebook.notebook_path,$("#upload-data-container").addClass("hide-me"),$("#final-page").removeClass("hide-me"),$("#previous").prop("disabled",!1),e.text("Check and edit the metadata for the notebook before uploading to eData."),$("#next").text("Publish")}).catch(function(){var t=$("<div/>").addClass("upload-error").css("color","red").text("File upload failed - please try again.");e.after(t)})}}}},notebook:t.notebook,keyboard_manager:t.notebook.keyboard_manager});_.on("shown.bs.modal",function(){$(".modal-footer > button.btn-sm").eq(1).removeAttr("data-dismiss").attr("id","previous").prop("disabled",!0),$(".modal-footer > button.btn-sm").eq(2).removeAttr("data-dismiss").attr("id","next")})},h={help:"Publish notebook",help_index:"a",icon:"fa-upload",handler:u},b="linker_extension",v="publish-notebook",m={help:"Publish data bundle",help_index:"a",icon:"fa-upload",handler:f},_="linker_extension",y="publish-bundle",g={help:"Publish notebook and data bundle",help_index:"a",icon:"fa-upload",handler:c},x="linker_extension",C="publish-notebook-and-data-bundle",k=function(){t.actions.register(h,v,b),$("#publish_notebook").click(function(){u()}),t.actions.register(m,y,_),$("#publish_bundle").click(function(){f()}),t.actions.register(g,C,x),$("#publish_notebook_and_bundle").click(function(){c()})};e.exports={load:k}}.apply(t,r),!(void 0!==n&&(e.exports=n))},function(e,t,a){var r,n;r=[a(7),a(8),a(10),a(9),a(13)],n=function(t,a,r){var n=function(){var e=t.notebook.get_cells(),a=Object.create(null);if("databundle_url"in t.notebook.metadata&&(a[t.notebook.metadata.databundle_url]=!0),"reportmetadata"in t.notebook.metadata&&t.notebook.metadata.reportmetadata.citations.forEach(function(e){a[e]=!0}),e.forEach(function(e){if(e.metadata.reference_cell===!0){var r=t.notebook.find_cell_index(e);t.notebook.delete_cell(r)}else"referenceURLs"in e.metadata&&e.metadata.referenceURLs.forEach(function(e){a[e]=!0})}),Object.keys(a).length>0){var n=t.notebook.insert_cell_at_bottom("markdown"),o="## References\n";Object.keys(a).forEach(function(e){o=o+"["+e+"]("+e+")\n\n"}),n.set_text(o),n.execute(),n.metadata.reference_cell=!0}else r.create_alert("alert-danger","Reference cell not generated since there are no references specified. Specify references by adding them to the notebook metadata, using the cell reference toolbar to add references to specific cells or by uploading a data bundle to DSpace from this notebook.")},o={help:"Generate references",help_index:"f",icon:"fa-quote-right",handler:n},i="linker_extension",d="generate-references",l=function(){t.actions.register(o,d,i),$("#generate_references").click(function(){n()})};e.exports={load:l}}.apply(t,r),!(void 0!==n&&(e.exports=n))}])});